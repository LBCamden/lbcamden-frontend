import * as GOVUK from "/govuk-frontend.min.js";
GOVUK.initAll();
function nodeListForEach(nodes, callback) {
  if (window.NodeList.prototype.forEach) {
    return nodes.forEach(callback);
  }
  for (var i = 0; i < nodes.length; i++) {
    callback.call(window, nodes[i], i, nodes);
  }
}
function generateUniqueID() {
  var d = (/* @__PURE__ */ new Date()).getTime();
  if (typeof window.performance !== "undefined" && typeof window.performance.now === "function") {
    d += window.performance.now();
  }
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(c) {
    var r = (d + Math.random() * 16) % 16 | 0;
    d = Math.floor(d / 16);
    return (c === "x" ? r : r & 3 | 8).toString(16);
  });
}
const settings = {
  minWidth: "40.0625em",
  desktop: "48em"
};
var DEBOUNCE_TIMEOUT_IN_SECONDS = 1;
function Button($module) {
  this.$module = $module;
  this.debounceFormSubmitTimer = null;
}
Button.prototype.handleKeyDown = function(event) {
  var target = event.target;
  if (target.getAttribute("role") === "button" && event.key === "Space") {
    event.preventDefault();
    target.click();
  }
};
Button.prototype.debounce = function(event) {
  var target = event.target;
  if (target.getAttribute("data-prevent-double-click") !== "true") {
    return;
  }
  if (this.debounceFormSubmitTimer) {
    event.preventDefault();
    return false;
  }
  this.debounceFormSubmitTimer = setTimeout((function() {
    this.debounceFormSubmitTimer = null;
  }).bind(this), DEBOUNCE_TIMEOUT_IN_SECONDS * 1e3);
};
Button.prototype.init = function() {
  this.$module.addEventListener("keydown", this.handleKeyDown);
  this.$module.addEventListener("click", this.debounce);
};
function LBCamdenGuideContent($module) {
  this.$module = $module;
}
LBCamdenGuideContent.prototype.init = function() {
  if (!this.$module) {
    return;
  }
  window.addEventListener("hashchange", () => this.showActiveGuide());
  this.showActiveGuide({ handleNotFound: true });
  this.$module.classList.add("lbcamden-guide-content--loaded");
};
LBCamdenGuideContent.prototype.showActiveGuide = function({ handleNotFound } = {}) {
  if (!this.$module) return;
  if (!window.location.hash) {
    window.history.replaceState(null, null, window.location.pathname + window.location.search);
  }
  const articles = this.getArticles();
  const activeItem = this.getActiveItem();
  if (!handleNotFound && !activeItem) {
    return;
  }
  for (const item of articles) {
    this.setArticleVisibility(item, item === activeItem);
  }
  if (activeItem) {
    const notFoundContent = this.getNotFoundArticle();
    this.setArticleVisibility(notFoundContent, false, {
      hiddenAttr: true
    });
  } else {
    const notFoundContent = this.getNotFoundArticle();
    this.setArticleVisibility(notFoundContent, true, {
      setContent: DEFAULT_NOT_FOUND_CONTENT,
      setHeading: DEFAULT_NOT_FOUND_HEADING,
      setPagination: { next: articles[0] },
      hiddenAttr: true
    });
  }
  window.scrollTo({ top: 0, behavior: "instant" });
};
LBCamdenGuideContent.prototype.setPagination = function({ next, prev }) {
  const [prevTarget, nextTarget] = this.getPaginationTargets();
  prevTarget.querySelector(".govuk-pagination__link-label").innerText = prev && getHeading(prev);
  nextTarget.querySelector(".govuk-pagination__link-label").innerText = next && getHeading(next);
  prevTarget.querySelector(".govuk-pagination__link").href = prev && `#${prev.dataset.guideArticle}`;
  nextTarget.querySelector(".govuk-pagination__link").href = next && `#${next.dataset.guideArticle}`;
  this.$module.classList.toggle("lbcamden-guide-content--prev", !!prev);
  this.$module.classList.toggle("lbcamden-guide-content--next", !!next);
};
LBCamdenGuideContent.prototype.setArticleVisibility = function(article, visible, { setPagination, setContent, setHeading, hiddenAttr } = {}) {
  const content = article.querySelector(".lbcamden-guide-content__item");
  if (visible) {
    const articles = this.getArticles();
    const i = articles.indexOf(article);
    const prev = articles[i - 1];
    const next = articles[i + 1];
    if (content && setContent) {
      content.innerHTML = setContent;
    }
    if (setHeading) {
      const h2 = article.querySelector("h2");
      if (h2) {
        h2.innerText = setHeading;
      }
    }
    this.setPagination(setPagination || { next, prev });
  }
  if (hiddenAttr) {
    article.hidden = !visible;
  } else {
    article.classList.toggle("lbcamden-guide-content--hidden", !visible);
  }
};
LBCamdenGuideContent.prototype.getArticles = function() {
  return Array.from(this.$module.querySelectorAll("[data-guide-article]"));
};
LBCamdenGuideContent.prototype.getActiveItem = function() {
  const targets = this.getArticles();
  const id = window.location.hash.substring(1);
  if (!id) {
    return targets[0];
  }
  for (const t of targets) {
    if (t.dataset.guideArticle === id) {
      return t;
    }
  }
};
LBCamdenGuideContent.prototype.getPaginationTargets = function() {
  return [
    this.$module.querySelector(".govuk-pagination__prev"),
    this.$module.querySelector(".govuk-pagination__next")
  ];
};
LBCamdenGuideContent.prototype.getNotFoundArticle = function() {
  return this.$module.querySelector("[data-guide-not-found]");
};
const DEFAULT_NOT_FOUND_HEADING = "Sorry, this content has been moved or deleted.";
const DEFAULT_NOT_FOUND_CONTENT = "<p>Try navigating the topic or search the site.</p>";
function getHeading(content) {
  const heading = content.querySelector("[data-guide-heading]");
  return heading && heading.innerText;
}
function LBCamdenGuideHeader($module) {
  this.$module = $module;
}
LBCamdenGuideHeader.prototype.init = function() {
  if (!this.$module) {
    return;
  }
  window.addEventListener("hashchange", () => this.updateActiveLink());
  this.updateActiveLink({ handleNotFound: true });
};
LBCamdenGuideHeader.prototype.updateActiveLink = function({ handleNotFound } = {}) {
  if (!handleNotFound) {
    if (!this.$module.querySelector(`[href="${window.location.hash}"]`)) {
      return;
    }
  }
  const isEmptyHash = !window.location.hash || window.location.hash === "#";
  let i = 0;
  for (const link of this.getLinks()) {
    if (i === 0 && isEmptyHash) {
      link.classList.toggle(":active", true);
    } else {
      const fullUrl = new URL(link.href, window.location.href);
      const isActive = !isEmptyHash && fullUrl.href === window.location.href;
      link.classList.toggle(":active", isActive);
    }
    i += 1;
  }
};
LBCamdenGuideHeader.prototype.getLinks = function() {
  return this.$module.querySelectorAll(".govuk-link");
};
function LBCamdenHeader($module) {
  this.$module = $module;
  this.$navigationToggle = this.$module.querySelector(".lbcamden-header__navigation-top-toggle-button");
  this.$navigationMenu = this.$module.querySelector(".lbcamden-header__navigation-items");
  this.$searchToggle = this.$module.querySelector(".lbcamden-header__search-toggle-button");
  this.$searchMenu = this.$module.querySelector(".lbcamden-header__search-items");
  this.$emergencyBanner = this.$module.querySelector(".lbcamden-header__emergency-banner");
  this.$buttons = this.$module.querySelectorAll("button[aria-controls][data-toggle-mobile-group][data-toggle-desktop-group]");
  this.$menuButtons = this.$module.querySelectorAll(".lbcamden-header__navigation-item--with-children");
  this.$phaseBanner = document.querySelector(".govuk-phase-banner");
  this.$navContainer = this.$module.children[0];
  this.hiddenButtons = this.$module.querySelectorAll("button[hidden]");
  this.$contentShiftContainer = this.$module.querySelector(".lbcamden-header__bar") || this.$module;
  this.menuOpen = false;
  this.searchOpen = false;
  this.lastWindowSize = null;
}
LBCamdenHeader.prototype.init = function() {
  if (!this.$module) {
    return;
  }
  this.$module.classList.add("js-module-initialised");
  if (typeof window.matchMedia === "function") {
    this.setupResponsiveChecks();
  }
};
LBCamdenHeader.prototype.setupResponsiveChecks = function() {
  this.mql = window.matchMedia("(min-width: " + settings.desktop + ")");
  this.mql.addListener(this.checkMode.bind(this));
  this.checkMode();
};
LBCamdenHeader.prototype.checkMode = function() {
  if (this.mql.matches) {
    this.teardownMobileMenu();
    this.setupDesktopMenu();
  } else {
    this.teardownDesktopMenu();
    this.setupMobileMenu();
  }
};
LBCamdenHeader.prototype.setupMobileMenu = function() {
  this.setAttributes("mobile");
  if (this.$navigationMenu != null) {
    this.$navigationToggle.boundMenuClick = this.handleMenuButtonClick.bind(this);
    this.$navigationToggle.addEventListener("click", this.$navigationToggle.boundMenuClick, true);
  }
  if (this.$searchMenu != null) {
    this.$searchToggle.boundSearchClick = this.handleSearchButtonClick.bind(this);
    this.$searchToggle.addEventListener("click", this.$searchToggle.boundSearchClick, true);
  }
};
LBCamdenHeader.prototype.teardownMobileMenu = function() {
  this.unsetAttributes("mobile");
  if (this.$navigationMenu != null) {
    this.$navigationToggle.removeEventListener("click", this.$navigationToggle.boundMenuClick, true);
  }
  if (this.$searchMenu != null) {
    this.$searchToggle.removeEventListener("click", this.$searchToggle.boundSearchClick, true);
  }
};
LBCamdenHeader.prototype.setupDesktopMenu = function() {
  this.setAttributes("desktop");
  if (this.$searchMenu != null) {
    this.$searchToggle.boundSearchClick = this.handleSearchButtonClick.bind(this);
    this.$searchToggle.addEventListener("click", this.$searchToggle.boundSearchClick, true);
  }
};
LBCamdenHeader.prototype.teardownDesktopMenu = function() {
  this.unsetAttributes("desktop");
  if (this.$navigationMenu != null) {
    this.$navigationToggle.removeEventListener("click", this.$navigationToggle.boundMenuClick, true);
  }
  if (this.$searchMenu != null) {
    this.$searchToggle.removeEventListener("click", this.$searchToggle.boundSearchClick, true);
  }
};
LBCamdenHeader.prototype.menuItemClick = function(e) {
  let theTargetID = e.target.getAttribute("aria-controls");
  if (theTargetID == null) {
    theTargetID = e.target.parentNode.getAttribute("aria-controls");
    e.target.parentNode.classList.toggle("lbcamden-header__open-button");
  } else {
    e.target.classList.toggle("lbcamden-header__open-button");
  }
  this.$module.querySelectorAll(".lbcamden-header__navigation-second-toggle-button:not([aria-controls=" + theTargetID + "])").forEach((i) => i.classList.remove("lbcamden-header__open-button"));
  const theTarget = document.getElementById(theTargetID);
  if (this.mql.matches === true) {
    this.$module.querySelectorAll(".lbcamden-header__navigation-dropdown-menu:not(#" + theTargetID + ")").forEach((i) => i.setAttribute("hidden", true));
  }
  document.getElementById(theTargetID).getAttribute("hidden") != null ? document.getElementById(theTargetID).removeAttribute("hidden") : document.getElementById(theTargetID).setAttribute("hidden", "true");
  if (this.mql.matches === true) {
    this.menuContentShift(theTarget.offsetHeight);
  }
  if (this.$searchMenu != null) {
    this.closeSearch(this.$searchToggle, this.$searchMenu);
  }
};
LBCamdenHeader.prototype.menuContentShift = function(offsetPixels) {
  if (this.$emergencyBanner) {
    this.$emergencyBanner.style.marginTop = offsetPixels + "px";
  } else {
    this.$contentShiftContainer.style.marginBottom = offsetPixels + "px";
  }
};
LBCamdenHeader.prototype.setAttributes = function($type) {
  if ($type === "mobile") {
    if (this.$navigationMenu != null) {
      this.$navigationToggle.removeAttribute("hidden");
      this.$navigationToggle.setAttribute("aria-expanded", false);
      this.$navigationMenu.setAttribute("hidden", true);
    }
  }
  if (this.$searchMenu != null) {
    this.$searchMenu.setAttribute("hidden", true);
    this.$searchToggle.setAttribute("aria-expanded", false);
    this.$searchToggle.setAttribute("aria-label", "Show search menu");
    this.$module.querySelector(".lbcamden-header__search-item-link").setAttribute("hidden", true);
    this.$module.querySelector(".lbcamden-header__search-and-popular").removeAttribute("hidden");
    this.$searchToggle.removeAttribute("hidden");
  }
  nodeListForEach(this.$menuButtons, (function($button) {
    $button.querySelector(".lbcamden-header__navigation-item-link").setAttribute("hidden", true);
    $button.querySelector(".lbcamden-header__navigation-second-toggle-button").removeAttribute("hidden");
    $button.boundMenuItemClick = this.menuItemClick.bind(this);
    $button.querySelector("button").addEventListener("click", $button.boundMenuItemClick, true);
  }).bind(this));
};
LBCamdenHeader.prototype.unsetAttributes = function($type) {
  if ($type === "mobile") {
    if (this.$navigationMenu != null) {
      this.$navigationToggle.setAttribute("hidden", true);
      this.$navigationMenu.removeAttribute("hidden");
    }
    if (this.$searchMenu != null) {
      this.$searchToggle.setAttribute("hidden", true);
      this.$searchMenu.removeAttribute("hidden");
    }
  }
  this.$module.style.marginBottom = "0px";
  this.searchOpen = false;
  this.menuOpen = false;
  if (this.$navigationMenu != null) {
    this.closeDesktopMenus();
  }
  if (this.$searchMenu != null) {
    this.$searchToggle.classList.remove("lbcamden-header__open-button");
  }
  nodeListForEach(this.$menuButtons, function($button) {
    $button.querySelector("button").removeEventListener("click", $button.boundMenuItemClick, true);
  });
};
LBCamdenHeader.prototype.handleMenuButtonClick = function() {
  if (this.menuOpen === true) {
    this.closeMenu(this.$navigationToggle, this.$navigationMenu);
  } else {
    this.openMenu(this.$navigationToggle, this.$navigationMenu);
  }
};
LBCamdenHeader.prototype.handleSearchButtonClick = function() {
  if (this.searchOpen === true) {
    this.closeSearch(this.$searchToggle, this.$searchMenu);
    if (this.mql.matches === true) {
      this.$module.style.marginBottom = "0";
      this.menuContentShift(0);
    }
  } else {
    this.openSearch(this.$searchToggle, this.$searchMenu);
    if (this.mql.matches === true) {
      this.menuContentShift(this.$searchMenu.offsetHeight);
    }
  }
};
LBCamdenHeader.prototype.openMenu = function($button, $target) {
  this.menuOpen = true;
  $button.classList.add("lbcamden-header__open-button");
  $button.setAttribute("aria-expanded", true);
  $button.setAttribute("aria-label", "Hide navigation menu");
  $button.classList.add("lbcamden-header__open-button");
  $target.removeAttribute("hidden");
  if (this.$searchMenu != null) {
    this.closeSearch(this.$searchToggle, this.$searchMenu);
  }
};
LBCamdenHeader.prototype.closeMenu = function($button, $target) {
  this.menuOpen = false;
  this.menuContentShift(0);
  if (this.$navigationMenu != null) {
    $button.classList.remove("lbcamden-header__open-button");
    $button.setAttribute("aria-expanded", false);
    $button.setAttribute("aria-label", "Show navigation menu");
    $button.classList.remove("lbcamden-header__open-button");
    $target.setAttribute("hidden", true);
  }
};
LBCamdenHeader.prototype.closeDesktopMenus = function() {
  this.$module.querySelectorAll(".lbcamden-header__navigation-dropdown-menu").forEach((x) => x.setAttribute("hidden", true));
};
LBCamdenHeader.prototype.openSearch = function($button, $target) {
  this.searchOpen = true;
  $button.setAttribute("aria-expanded", true);
  $button.setAttribute("aria-label", "Hide navigation menu");
  this.$module.querySelectorAll(".lbcamden-header__open-button").forEach((x) => x.classList.remove("lbcamden-header__open-button"));
  $button.classList.add("lbcamden-header__open-button");
  $target.style.top = this.$navContainer.offsetHeight + "px";
  $target.removeAttribute("hidden");
  if (this.mql.matches !== true) {
    this.closeMenu(this.$navigationToggle, this.$navigationMenu);
  } else {
    this.closeDesktopMenus();
  }
};
LBCamdenHeader.prototype.closeSearch = function($button, $target) {
  this.searchOpen = false;
  $button.setAttribute("aria-expanded", false);
  $button.setAttribute("aria-label", "Show navigation menu");
  $button.classList.remove("lbcamden-header__open-button");
  $target.setAttribute("hidden", true);
};
function initAll(options) {
  options = typeof options !== "undefined" ? options : {};
  var scope = typeof options.scope !== "undefined" ? options.scope : document;
  var $LBCamdenHeaders = scope.querySelectorAll('[data-module="lbcamden-header"]');
  nodeListForEach($LBCamdenHeaders, function($LBCamdenHeader) {
    new LBCamdenHeader($LBCamdenHeader).init();
  });
  var $LBCamdenButtons = scope.querySelectorAll('[data-module="lbcamden-button"]');
  nodeListForEach($LBCamdenButtons, function($LBCamdenButton) {
    new Button($LBCamdenButton).init();
  });
  var $LBCamdenGuideContents = scope.querySelectorAll('[data-module="lbcamden-guide-content"]');
  nodeListForEach($LBCamdenGuideContents, function($LBCamdenGuideContent) {
    new LBCamdenGuideContent($LBCamdenGuideContent).init();
  });
  var $LBCamdenGuideHeaders = scope.querySelectorAll('[data-module="lbcamden-guide-header"]');
  nodeListForEach($LBCamdenGuideHeaders, function($LBCamdenGuideHeader) {
    new LBCamdenGuideHeader($LBCamdenGuideHeader).init();
  });
}
initAll();
//# sourceMappingURL=lbcamden-frontend-0.5.3.min.js.map
